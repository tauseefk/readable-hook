{"version":3,"file":"index.js","sources":["../src/useStreamingQuery.tsx"],"sourcesContent":["import { useCallback, useState } from 'react';\n\nconst readableTextStream = async (\n  path: string,\n  options?: {\n    method?: 'GET' | 'POST';\n    payload?: any;\n    headers?: Record<string, string>;\n  },\n) => {\n  const response = await fetch(path, options);\n  if (!response.body) throw new Error('No response body found.');\n\n  return response.body.pipeThrough(new TextDecoderStream());\n};\n\n/**\n * Fetch data from a streaming endpoint\n * @param path endpoint to fetch the response from\n * @returns {[string, () => void]} returns a tuple of data retrieved from the stream, and a query trigger function\n */\nexport const useStreamingQuery = (path: string): [string, () => void] => {\n  const [data, setData] = useState('');\n\n  const queryStream = useCallback(async () => {\n    const response = await readableTextStream(path);\n    if (!response) return;\n\n    const reader = response.getReader();\n    async function syncWithTextStream() {\n      const { value, done } = await reader.read();\n      if (!done) {\n        setData(value);\n\n        requestAnimationFrame(() => {\n          syncWithTextStream();\n        });\n      }\n    }\n\n    syncWithTextStream();\n  }, [path]);\n\n  return [data, queryStream];\n};"],"names":["useState","useCallback"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAM,kBAAkB,GAAG,UACzB,IAAY,EACZ,OAIC,EAAA,EAAA,OAAA,SAAA,CAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;;;;AAEgB,YAAA,KAAA,CAAA,EAAA,OAAA,CAAA,CAAA,YAAM,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC,CAAA,CAAA;;AAArC,gBAAA,QAAQ,GAAG,EAA0B,CAAA,IAAA,EAAA,CAAA;gBAC3C,IAAI,CAAC,QAAQ,CAAC,IAAI;AAAE,oBAAA,MAAM,IAAI,KAAK,CAAC,yBAAyB,CAAC,CAAC;gBAE/D,OAAO,CAAA,CAAA,aAAA,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,iBAAiB,EAAE,CAAC,CAAC,CAAA;;;KAC3D,CAAC;AAEF;;;;AAIG;AACI,IAAM,iBAAiB,GAAG,UAAC,IAAY,EAAA;IACtC,IAAA,EAAA,GAAkBA,cAAQ,CAAC,EAAE,CAAC,EAA7B,IAAI,GAAA,EAAA,CAAA,CAAA,CAAA,EAAE,OAAO,GAAA,EAAA,CAAA,CAAA,CAAgB,CAAC;IAErC,IAAM,WAAW,GAAGC,iBAAW,CAAC,YAAA,EAAA,OAAA,SAAA,CAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,KAAA,CAAA,EAAA,YAAA;AAK9B,QAAA,SAAe,kBAAkB,GAAA;;;;;AACP,wBAAA,KAAA,CAAA,EAAA,OAAA,CAAA,CAAA,YAAM,MAAM,CAAC,IAAI,EAAE,CAAA,CAAA;;AAArC,4BAAA,EAAA,GAAkB,SAAmB,EAAnC,KAAK,GAAA,EAAA,CAAA,KAAA,EAAE,IAAI,GAAA,EAAA,CAAA,IAAA,CAAA;4BACnB,IAAI,CAAC,IAAI,EAAE;gCACT,OAAO,CAAC,KAAK,CAAC,CAAC;AAEf,gCAAA,qBAAqB,CAAC,YAAA;AACpB,oCAAA,kBAAkB,EAAE,CAAC;AACvB,iCAAC,CAAC,CAAC;AACJ,6BAAA;;;;;AACF,SAAA;;;;AAbgB,gBAAA,KAAA,CAAA,EAAA,OAAA,CAAA,CAAA,YAAM,kBAAkB,CAAC,IAAI,CAAC,CAAA,CAAA;;AAAzC,oBAAA,QAAQ,GAAG,EAA8B,CAAA,IAAA,EAAA,CAAA;AAC/C,oBAAA,IAAI,CAAC,QAAQ;wBAAE,OAAO,CAAA,CAAA,YAAA,CAAA;AAEhB,oBAAA,MAAM,GAAG,QAAQ,CAAC,SAAS,EAAE,CAAC;AAYpC,oBAAA,kBAAkB,EAAE,CAAC;;;;AACtB,KAAA,CAAA,CAAA,EAAA,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC;AAEX,IAAA,OAAO,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;AAC7B;;;;"}